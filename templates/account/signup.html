<!-- templates/account/signup.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}회원가입 – 우리동네공모전{% endblock %}

{% block content %}
<main class="login-section">
  <div class="login-card">
    <h2 class="auth-heading">회원가입</h2>
    <form method="post" class="auth-form">
      {% csrf_token %}

      <div class="form-group">
        <label for="id_user_type">회원 분류</label>
        <div class="select-wrapper">
          <select name="user_type" id="id_user_type" class="user-type-select">
            <option value="admin">일반 회원</option>
            <option value="business">사업체</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="{{ form.nickname.id_for_label }}">닉네임</label>
        <div class="input-with-button">
          {{ form.nickname }}
          <button type="button" class="check-email" onclick="checkNickname()">중복확인</button>
        </div>
        <span id="nickname-message" style="font-size: 0.9em;"></span> <!-- ✅ 닉네임 결과 표시 -->
      </div>

      <div class="form-group">
        <label for="{{ form.email.id_for_label }}">이메일</label>
        <div class="input-with-button">
          {{ form.email }}
          <button type="button" class="check-email" onclick="checkEmail()">중복확인</button>
        </div>
        <span id="email-message" style="font-size: 0.9em;"></span> <!-- ✅ 이메일 결과 표시 -->
      </div>

      <div class="form-group">
        <label for="{{ form.password1.id_for_label }}">비밀번호</label>
        {{ form.password1 }}
      </div>

      <div class="form-group">
        <label for="{{ form.password2.id_for_label }}">비밀번호 확인</label>
        {{ form.password2 }}
        <p id="pw-match-msg" style="margin-top: 4px;"></p> <!-- ✅ 비밀번호 확인 메시지 -->
      </div>

      <button type="submit" class="login-submit">회원가입</button>
    </form>

    <div class="login-footer auth-footer-links">
      <a href="{% url 'account:login' %}">로그인</a>
    </div>
  </div>
</main>
{% endblock %}

{% block extra_scripts %}
<script>
  function checkNickname() {
    const nickname = document.getElementById("id_nickname").value;
    const msg = document.getElementById("nickname-message");

    fetch(`/account/ajax/check_nickname/?nickname=${nickname}`)
      .then(response => response.json())
      .then(data => {
        msg.textContent = data.message;
        msg.style.color = data.is_taken ? "red" : "green";
      });
  }

  function checkEmail() {
    const email = document.getElementById("id_email").value;
    const msg = document.getElementById("email-message");

    fetch(`/account/ajax/check_email/?email=${email}`)
      .then(response => response.json())
      .then(data => {
        msg.textContent = data.message;
        msg.style.color = data.is_taken ? "red" : "green";
      });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const pw1 = document.getElementById("id_password1");
    const pw2 = document.getElementById("id_password2");
    const msg = document.getElementById("pw-match-msg");

    pw2.addEventListener("input", () => {
      if (pw2.value !== pw1.value) {
        msg.textContent = "비밀번호가 일치하지 않습니다.";
        msg.style.color = "red";
      } else {
        msg.textContent = "비밀번호가 일치합니다.";
        msg.style.color = "green";
      }
    });
  });
</script>
{% endblock %}
